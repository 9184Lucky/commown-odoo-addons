<?xml version="1.0" encoding="utf-8"?>
<odoo>

  <data>

    <record id="fp2-camera" model="ir.ui.view">
      <field name="name">Self-troubleshoot an FP2 camera</field>
      <field name="type">qweb</field>
      <field name="key">website.self-troubleshoot-fp2-camera</field>
      <field name="arch" type="xml">

        <t t-name="website.self-troubleshoot-fp2-camera">
          <t t-call="commown-self-troubleshoot.web-layout">
            <t t-set="title">Commown - Auto-dépannage - Fairphone 2 : Caméra</t>
            <t t-set="head">
              <script type="text/javascript">
$(document).ready(function() {

    const wizard = setUpWizard($('#smartwizard'));

    $('#camera_model').change(function () {
        wizard.toggleStep(2, this.value==='new');
        wizard.toggleStep(5, this.value==='new');
    });

    $('#tighten_screws_solved_pb').change(function () {
        wizard.toggleStep(3, this.value==='no');
        wizard.toggleStep(4, this.value==='no');
        wizard.toggleStep(5, this.value==='yes');
    });

});
              </script>
            </t>

            <!-- Variables à modifier ici -->
            <t t-set="contract_name_like">FP2/</t>
            <t t-set="tag_names">Appareil FP2,FP MOD caméra</t>
            <t t-set="issue_title">FP2 - Caméra</t>
            <t t-set="issue_description_template">issue-description-fp2-camera</t>
            <t t-set="stage_pending" t-value="env.ref('commown_self_troubleshooting.stage_pending').id"/>
            <t t-set="stage_solved" t-value="env.ref('commown_self_troubleshooting.stage_solved').id"/>
            <!-- Fin des variables à modifier -->

            <t t-set="partner" t-value="env.user.partner_id"/>
            <t t-set="contracts"
               t-value="env['account.analytic.account'].sudo().search([('partner_id', '=', partner.id), ('contract_template_id.name', 'like', contract_name_like), ('date_end', '=', False)])" />
            <t t-set="delivery"
               t-value="env['res.partner'].browse(partner.address_get(['delivery']).get('delivery', partner.id))"/>

            <div class="container">
              <br />
              <form action="/self-troubleshoot/" method="post" accept-charset="utf-8"
                    id="myForm" role="form">

                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                <input type="hidden" name="self-troubleshoot-type" id="self-troubleshoot-type" t-att-value="issue_title"/>
                <input type="hidden" name="tags" id="tags" t-att-value="tag_names"/>
                <input type="hidden" name="issue-description-template" id="issue-description-template" t-att-value="issue_description_template"/>

                <div id="smartwizard">
                  <ul>
                    <li><a href="#step-0">Contexte<br /><small>Appareil concerné</small></a></li>
                    <li><a href="#step-1">Étape 1<br /><small>Modèle de la caméra</small></a></li>
                    <li disabled="disabled"><a href="#step-2">Étape 2<br/><small>Resserrage des vis</small></a></li>
                    <li disabled="disabled"><a href="#step-3">Étape 3<br/><small>Expédition</small></a></li>
                    <li disabled="disabled"><a href="#step-4">Étape 4<br/><small>Confirmation</small></a></li>
                    <li disabled="disabled"><a href="#step-5">Étape 5<br/><small>Problème résolu</small></a></li>
                    <li><a href="#step-6">Étape 6<br/><small>Contacter un humain</small></a></li>
                  </ul>

                  <div>
                    <t t-call="commown_self_troubleshooting.step-contract-choice"/>

                    <div id="step-1">
                      <div class="clearfix">
                        <img class="pull-left" src="/commown_self_troubleshooting/static/images/FP2/camera/fp2_camera_front.jpg"
                             alt="Logo de commown" />
                        <h2>Modèle de la caméra</h2>
                        <p>Allez voir <a target="_blank" href="https://wiki.commown.coop/Reconnaître-la-version-de-votre-caméra">cette
                      page de notre wiki</a> et répondez à la question
                        ci-dessous :</p>
                      </div>
                      <div id="form-step-1" role="form" data-toggle="validator">
                        <div class="form-group">
                          <label for="camera_model">Modèle de caméra :</label>
                          <select class="form-control" required="required"
                                  id="camera_model" name="camera_model"
                                  data-required-error="Veuillez sélectionner un modèle de caméra dans la liste ci-dessus.">
                            <option disabled="disabled" selected="1" value="">-- Choisir une réponse --</option>
                            <option value="new">Nouveau modèle</option>
                            <option value="old">Ancien modèle</option>
                          </select>
                          <div class="help-block with-errors"></div>
                        </div>
                      </div>

                    </div>
                    <div id="step-2">
                      <h2>Resserrage des vis</h2>
                      <img src="/commown_self_troubleshooting/static/images/FP2/camera/fp2_screws.jpg"
                           alt="Éclaté d'un Fairphone 2 avec ses vis" style="display: block; margin: auto;"/>
                      <p>Avec ce modèle de caméra, le cas le plus fréquent de
                      dysfonctionnement est celui d'un faux contact. Essayez
                      de resserrer les vis de la caméra grace
                      à <a target='_blank'
                      href='https://fr.ifixit.com/Tutoriel/Remplacement+de+la+cam%C3%A9ra+arri%C3%A8re+du+Fairphone+2/54993'>ce
                      tutoriel en ligne</a>, puis dites-nous si le problème est résolu :</p>
                      <div id="form-step-2" role="form" data-toggle="validator">
                        <div class="form-group">
                          <select class="form-control" required="required"
                                  id="tighten_screws_solved_pb" name="tighten_screws_solved_pb"
                                  data-required-error="Veuillez sélectionner un élément de la liste ci-dessus.">
                            <option disabled="disabled" selected="1" value="">-- Choisir une réponse --</option>
                            <option value="yes">Le problème est résolu</option>
                            <option value="no">Le problème n'est pas résolu</option>
                          </select>
                          <div class="help-block with-errors"></div>
                        </div>
                      </div>
                    </div>

                    <t t-call="commown_self_troubleshooting.step-ship-module">
                      <t t-set="step">3</t>
                      <t t-set="new_module">une nouvelle caméra</t>
                    </t>

                    <div id="step-3">
                      <h2>Informations d'expédition</h2>
                      <p>Nous allons vous envoyer une nouvelle caméra pour
                      résoudre le problème. Veuillez vérifier attentivement
                      les informations d'expédition ci-dessous, et les
                      modifier en cas de besoin. Notez que le paquet sera
                      déposé directement dans votre boite aux lettres :
                      votre présence n'est pas requise lors du passage du
                      facteur.</p>
                      <div id="form-step-3" role="form" data-toggle="validator">

                        <div class="form-group">
                          <label for="name">Nom complet</label>
                          <input class="form-control" name="name" id="name" required="required"
                                 t-att-value="delivery.name"
                                 data-required-error="Saisissez un nom pour la livraison."></input>
                          <div class="help-block with-errors"></div>
                        </div>

                        <div class="form-group">
                          <label for="street">Rue - 1ère ligne</label>
                          <input class="form-control" name="street" id="street" maxlength="35"
                                 required="required" t-att-value="delivery.street"
                                 data-required-error="Saisissez le numéro et nom de la rue pour la livraison."></input>
                          <div class="help-block with-errors"></div>
                        </div>

                        <div class="form-group">
                          <label for="street2">Rue - 2ème ligne (si nécessaire)</label>
                          <input class="form-control" name="street2" id="street2" maxlength="35"
                                 t-att-value="delivery.street2"></input>
                          <div class="help-block with-errors"></div>
                        </div>

                        <div class="row">
                          <div class="col-xs-4 form-group">
                            <label for="zipcode">Code postal</label>
                            <input class="form-control" name="zipcode" id="zipcode" required="required"
                                   t-att-value="delivery.zip"
                                   data-required-error="Saisissez un code postal pour la livraison."></input>
                            <div class="help-block with-errors"></div>
                          </div>
                          <div class="col-xs-4 form-group">
                            <label for="city">Ville</label>
                            <input class="form-control" name="city" id="city" required="required"
                                   t-att-value="delivery.city"
                                   data-required-error="Saisissez une ville pour la livraison."></input>
                            <div class="help-block with-errors"></div>
                          </div>
                          <div class="col-xs-4 form-group">
                            <label for="country">Pays</label>
                            <select class="form-control" id="country" name="country" required="required"
                                    data-required-error="Saisissez un pays pour la livraison.">
                              <option selected="1" t-att-value="delivery.country_id.name"><t t-esc="delivery.country_id.name"/></option>
                              <option t-if="delivery.country_id.name != 'France'" value="France">France</option>
                              <option t-if="delivery.country_id.name != 'Belgique'" value="Belgique">Belgique</option>
                            </select>
                            <div class="help-block with-errors"></div>
                          </div>
                        </div>

                        <div class="row">
                          <div class="col-xs-6 form-group">
                            <label for="phone">Numéro de téléphone</label>
                            <input class="form-control" name="phone" id="phone" type="tel" required="required"
                                   t-att-value="delivery.phone or delivery.mobile"
                                   data-required-error="Saisissez un numéro de téléphone pour la livraison."></input>
                            <div class="help-block with-errors"></div>
                          </div>
                          <div class="col-xs-6 form-group">
                            <label for="email">Adresse email</label>
                            <input class="form-control" name="email" id="email" type="email"
                                   required="required" t-att-value="delivery.email"
                                   data-required-error="Saisissez une adresse email pour la livraison."></input>
                            <div class="help-block with-errors"></div>
                          </div>
                        </div>

                      </div>
                    </div>

                    <div id="step-4">
                      <h2>Confirmation de votre demande</h2>
                      <p>En appuyant sur le bouton ci-dessous, vous
                      confirmerez votre demande d'envoi.</p>
                      <p>Vous aurez besoin d’un tout petit tournevis
                      cruciforme, de taille #0
                      (voir <a target="_blank"
                      href="https://eustore.ifixit.com/fr/Outils/Tournevis-Cles/Tournevis-cruciforme-Phillips-n-0-iFixit-made-in-Germany.html">ici</a>).
                      Nous pouvons vous en prêter un à nous retourner
                      ensuite avec le module en panne.
                      </p>
                      <p>Une demande d'assistance va être créée
                      automatiquement lorsque vous aurez soumis ce
                      formulaire. Elle sera affichée ici, ce qui vous
                      donnera l'opportunité d'ajouter un mot à
                      l'attention de notre équipe de support, si besoin.
                      </p>

                      --<br/>
                      <p>L'équipe Commown,<br/>
                      <img alt="logo" src="https://shop.commown.coop/web/content/25787"/>
                      </p>
                      --<br/>

                      <div id="form-step-4" role="form" data-toggle="validator">

                        <div class="form-group">
                          <p>Avez-vous besoin d'un tournevis ?</p>
                          <label class="radio-inline" for="screwdriver-yes">Oui</label>
                          <input type="radio" name="screwdriver" id="screwdriver-yes"
                                 value="yes" required="required"
                                 data-required-error="Dites-nous si vous avez besoin d'un tournevis."></input>
                          <label class="radio-inline" for="screwdriver-no">Non</label>
                          <input type="radio" name="screwdriver" id="screwdriver-no"
                                 value="no" required="required"></input>
                          <div class="help-block with-errors"></div>
                        </div>

                        <div class="form-group">
                          <label for="more_info_step_4">Ajoutez ici toute information que vous jugerez utile :</label>
                          <textarea class="form-control" rows="3"
                                    id="more_info_step_4" name="more_info" />
                        </div>

                        <div class="form-group">
                          <input type="hidden" name="stage_id" t-att-value="stage_pending"/>
                          <button type="submit" class="btn btn-primary"
                                  name="action" value="ship">Confirmer ma demande</button>
                        </div>
                      </div>
                    </div>

                    <div id="step-5">
                      <h2>Problème résolu</h2>
                      <p>Vous avez réussi à résoudre le problème, bravo !</p>
                      <p>Nous espérons que cet outil vous a été utile pour y parvenir.</p>
                      <p>Dans le but de nous aider à améliorer continuellement le service aux
                      Commowners (notamment grâce aux statistiques de panne), vous pouvez nous
                      faire part de cette expérience au moyen du bouton d'envoi ci-dessous. Si
                      vous préférez ne pas nous fournir d'information, fermez simplement cette
                      page.
                      </p>

                      --<br/>
                      <p>L'équipe Commown,<br/>
                      <img alt="logo" src="https://shop.commown.coop/web/content/25787"/>
                      </p>
                      --<br/>

                      <div id="form-step-5" role="form" data-toggle="validator">

                        <div class="form-group">
                          <label for="more_info_step_5">Ajoutez ici toute information que vous jugerez utile :</label>
                          <textarea class="form-control" rows="3"
                                    id="more_info_step_5" name="more_info"/>
                        </div>

                        <div class="form-group">
                          <input type="hidden" name="stage_id" t-att-value="stage_solved"/>
                          <button type="submit" class="btn btn-primary"
                                  name="action" value="inform">Envoyer les informations</button>
                        </div>
                      </div>
                    </div>

                    <div id="step-6">
                      <h2>Contacter un être humain</h2> <p>Vous pouvez
                      ici directement créer une demande d'assistance à
                      notre intention en expliquant au mieux le souci
                      que vous rencontrez ci-dessous.</p>

                      --<br/>
                      <p>L'équipe Commown,<br/>
                      <img alt="logo" src="https://shop.commown.coop/web/content/25787"/>
                      </p>
                      --<br/>

                      <div id="form-step-6" role="form" data-toggle="validator">

                        <div class="form-group">
                          <label for="device_contract">Contrat de votre appareil :</label>
                          <select class="form-control" id="device_contract" name="device_contract" required="required">
                            <option disabled="disabled" selected="1" value="">-- Choisir une réponse --</option>
                            <t t-foreach="contracts" t-as="c">
                              <t t-set="date" t-value="c.date_start.split('-')"/>
                              <option
                                  t-att-value="c.id"
                                  t-esc="u'%s (démarré le %s/%s/%s)' % (c.name, date[2], date[1], date[0])"
                                  />
                            </t>
                          </select>
                          <div class="help-block with-errors"></div>
                        </div>

                        <div class="form-group">
                          <label for="more_info_step_6">En quoi pouvons-nous vous aider ?</label>
                          <textarea class="form-control" rows="3" required="required"
                                    id="more_info_step_6" name="more_info"/>
                        </div>

                        <div class="form-group">
                          <button type="submit" class="btn btn-primary"
                                  name="action" value="contact">Envoyer les informations</button>
                        </div>

                      </div>
                    </div>

                  </div>

                </div>
              </form>
            </div>

          </t>
        </t>
      </field>
    </record>

  </data>

</odoo>
