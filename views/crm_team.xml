<?xml version="1.0" encoding="utf-8"?>
<odoo>

  <record id="action_customisable_lead_form_view" model="ir.actions.server">
    <field name="name">Customisable lead form view server action</field>
    <field name="model_id" ref="crm.model_crm_lead"/>
    <field name="state">code</field>
    <field name="code">action = model.action_customisable_form_view()</field>
    <field eval="True" name="condition"/>
  </record>

  <record id="crm_team_salesteams_view_kanban" model="ir.ui.view">
    <!-- Replace every occurence of the original window action by
         previous server action to make the lead form view dynamic -->
    <field name="name">commown.team.kanban</field>
    <field name="model">crm.team</field>
    <field name="inherit_id" ref="crm.crm_team_salesteams_view_kanban"/>
    <field name="arch" type="xml">
      <data>

        <xpath expr="//div[contains(@class, 'o_kanban_primary_left')]//button"
               position="attributes">
          <attribute name="name">%(action_customisable_lead_form_view)d</attribute>
        </xpath>

        <xpath expr="//div[contains(@class, 'o_kanban_manage_view')]//div[contains(@t-if, 'use_opportunities')]//a"
               position="attributes">
          <attribute name="name">%(action_customisable_lead_form_view)d</attribute>
        </xpath>

      </data>
    </field>
  </record>

  <record id="sales_team_form_view_in_crm" model="ir.ui.view">
    <field name="name">crm.team.form.inherit</field>
    <field name="model">crm.team</field>
    <field name="inherit_id" ref="sales_team.crm_team_view_form"/>
    <field name="arch" type="xml">
      <xpath expr="//field[@name='alias_contact']" position="after">
        <field name="custom_lead_view_id"/>
      </xpath>
    </field>
  </record>

</odoo>
