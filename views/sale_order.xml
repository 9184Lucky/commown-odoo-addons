<?xml version="1.0"?>
<odoo>

  <record id="action_add_to_support_groups" model="ir.actions.server">
    <field name="name">Add buyer to product support groups</field>
    <field name="model_id" ref="sale.model_sale_order"/>
    <field name="state">code</field>
    <field name="code">
for so_line in record.order_line:
    for group in so_line.product_id.product_tmpl_id.support_group_ids:
        group.add_users(record.partner_id.user_ids)
    </field>
  </record>

  <record id="add_buyer_to_product_support_groups_ar" model="base.action.rule">
      <field name="name">Add buyer to support groups</field>
      <field name="model_id" ref="sale.model_sale_order"/>
      <field name="sequence">1</field>
      <field name="kind">on_write</field>
      <field name="filter_pre_domain">[('state', '=', 'draft')]</field>
      <field name="filter_domain">[('state', '=', 'sent')]</field>
      <field name="server_action_ids" eval="[(6,0,[ref('commown.action_add_to_support_groups')])]"/>
  </record>

</odoo>
