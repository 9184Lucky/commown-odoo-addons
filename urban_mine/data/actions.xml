<?xml version="1.0"?>
<odoo>

  <!-- Urban mine validation handling: send a label by email -->

  <record id="action_send_label" model="ir.actions.server">
    <field name="name">[commown] Urban mine: send label by email</field>
    <field name="model_id" ref="crm.model_crm_lead"/>
    <field name="sequence">5</field>
    <field name="state">code</field>
    <field name="binding_model_id" ref="crm.model_crm_lead"/>
    <field name="code">record.urban_mine_send_label("fp2-return-ins0")</field>
  </record>

  <record id="action_registration_validated" model="base.automation">
    <field name="name">[commown] Urban mine was validated</field>
    <field name="model_id" ref="crm.model_crm_lead"/>
    <field name="sequence">1</field>
    <field name="trigger">on_write</field>
    <field name="filter_pre_domain">[(u'stage_id', u'not ilike', u'[urban-mine: send-label]')]</field>
    <field name="filter_domain">[(u'stage_id', u'ilike', u'[urban-mine: send-label]')]</field>
    <field name="action_server_id" eval="ref('action_send_label')"/>
  </record>

  <!-- Urban mine payment handling: send an invoice and a coupon by email -->

  <record id="action_payment" model="ir.actions.server">
    <field name="name">[commown] Urban mine: send auto-invoice and coupon by email</field>
    <field name="model_id" ref="crm.model_crm_lead"/>
    <field name="sequence">5</field>
    <field name="state">code</field>
    <field name="binding_model_id" ref="crm.model_crm_lead"/>
    <field name="code"><![CDATA[
record.urban_mine_payment(
    env.ref('urban_mine.campaing'),
    env['product.product'].search([('default_code', '=', "urban-mine")])[0],
    env['account.journal'].search([('code', '=', 'RFCV')]),
    env['account.analytic.tag'].search([('name', 'in', ["EXPL", "FP2"])]),
    "Vente Fairphone 2",
)
]]>
    </field>
  </record>

  <record id="action_registration_payment" model="base.automation">
    <field name="name">[commown] Urban mine device payment to be done</field>
    <field name="model_id" ref="crm.model_crm_lead"/>
    <field name="sequence">1</field>
    <field name="trigger">on_write</field>
    <field name="filter_pre_domain">[(u'stage_id', u'not ilike', u'[urban-mine: payment]')]</field>
    <field name="filter_domain">[(u'stage_id', u'ilike', u'[urban-mine: payment]')]</field>
    <field name="action_server_id" eval="ref('urban_mine.action_payment')"/>
  </record>

</odoo>
